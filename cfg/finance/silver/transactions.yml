layer: silver
compute:
  engine: spark
  spark:
    app_name: "silver_fin"
    options:
      spark.sql.session.timeZone: "UTC"
io:
  source:
    type: files
    path: "s3://datalake/bronze/finance/transactions/"
    format: parquet
  sink:
    type: files
    format: parquet
    path: "s3://datalake/silver/finance/fact_transactions/"
transform:
  sql: |
    SELECT
      transaction_id,
      account_id,
      merchant_id,
      amount,
      currency,
      posted_date,
      CASE WHEN amount < 0 THEN 1 ELSE 0 END AS is_reversal
    FROM __INPUT__
dq:
  expectations:
    - type: not_null
      column: account_id
    - type: condition
      expr: "currency in ('USD','EUR','COP')"
