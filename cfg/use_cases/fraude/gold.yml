layer: gold
extends: "../../finance/gold/kpis.yml"
transform:
  sql: |
    SELECT
      posted_date,
      currency,
      COUNT_IF(risk_bucket = 'critical') AS critical_alerts,
      COUNT_IF(risk_bucket IN ('critical','high')) AS high_risk_alerts,
      SUM(amount) AS exposure
    FROM __BASE__
    GROUP BY posted_date, currency
dq:
  expectations:
    - type: not_null
      column: currency
