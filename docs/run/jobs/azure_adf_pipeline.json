{
  "$schema": "https://schema.management.azure.com/schemas/2019-04-01/deploymentTemplate.json#",
  "contentVersion": "1.0.0.0",
  "parameters": {
    "dryRun": {
      "type": "string",
      "defaultValue": "false"
    }
  },
  "resources": [
    {
      "name": "prodi-layered-pipeline",
      "type": "Microsoft.DataFactory/factories/pipelines",
      "apiVersion": "2018-06-01",
      "properties": {
        "activities": [
          {
            "name": "raw",
            "type": "ExecutePipeline",
            "typeProperties": {
              "pipeline": {
                "referenceName": "prodi-layer-raw",
                "type": "PipelineReference"
              },
              "parameters": {
                "configUri": "abfss://artifacts@datalake.dfs.core.windows.net/cfg/raw/azure.prod.yml",
                "dryRun": "@{pipeline().parameters.dryRun}"
              }
            }
          },
          {
            "name": "bronze",
            "type": "ExecutePipeline",
            "dependsOn": [
              {
                "activity": "raw",
                "dependencyConditions": ["Succeeded"]
              }
            ],
            "typeProperties": {
              "pipeline": {
                "referenceName": "prodi-layer-bronze",
                "type": "PipelineReference"
              },
              "parameters": {
                "configUri": "abfss://artifacts@datalake.dfs.core.windows.net/cfg/bronze/azure.prod.yml",
                "dryRun": "@{pipeline().parameters.dryRun}"
              }
            }
          },
          {
            "name": "silver",
            "type": "ExecutePipeline",
            "dependsOn": [
              {
                "activity": "bronze",
                "dependencyConditions": ["Succeeded"]
              }
            ],
            "typeProperties": {
              "pipeline": {
                "referenceName": "prodi-layer-silver",
                "type": "PipelineReference"
              },
              "parameters": {
                "configUri": "abfss://artifacts@datalake.dfs.core.windows.net/cfg/silver/azure.prod.yml",
                "dryRun": "@{pipeline().parameters.dryRun}"
              }
            }
          },
          {
            "name": "gold",
            "type": "ExecutePipeline",
            "dependsOn": [
              {
                "activity": "silver",
                "dependencyConditions": ["Succeeded"]
              }
            ],
            "typeProperties": {
              "pipeline": {
                "referenceName": "prodi-layer-gold",
                "type": "PipelineReference"
              },
              "parameters": {
                "configUri": "abfss://artifacts@datalake.dfs.core.windows.net/cfg/gold/azure.prod.yml",
                "dryRun": "@{pipeline().parameters.dryRun}"
              }
            }
          }
        ],
        "parameters": {
          "dryRun": {
            "type": "String",
            "defaultValue": "false"
          }
        }
      }
    }
  ]
}
